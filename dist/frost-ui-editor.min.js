!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@fr0st/ui"),require("@fr0st/query")):"function"==typeof define&&define.amd?define(["exports","@fr0st/ui","@fr0st/query"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).UI=e.UI||{},e.UI,e.fQuery)}(this,(function(e,t,o){"use strict";function s(){const e=window.getSelection();return e.rangeCount?e.getRangeAt(0):null}function i(e){const t=o.createRange();return t.selectNode(e),r(t),t}function r(e){if(!e)return;const t=window.getSelection();t.removeAllRanges(),t.addRange(e)}let n=!1,a=0;const l=new Set;class d extends t.BaseComponent{constructor(e,t){super(e,t),this._options.buttons||(this._options.buttons=this.constructor.buttons),this._options.fonts||(this._options.fonts=this.constructor.fonts),this._options.fonts=this._options.fonts.filter((e=>document.fonts.check(`12px ${e}`))),this._options.fonts.includes(this._options.defaultFont)||(this._options.defaultFont=this._options.fonts.slice().shift()),this._buttons=[],this._history=[],this._redoHistory=[],this._render();const i=o.getValue(this._node);o.setHTML(this._editor,i),o.setValue(this._source,i);const d=s();this._focusEditor(),this._execCommand("defaultParagraphSeparator","p"),this._checkEmpty(),this._refreshToolbar(),r(d),this._events(),this._normalize(),this._updateValue(),this._refreshDisabled(),l.add(this),n||(a=0,o.addEvent(document.body,"dragenter.ui.editor",(e=>{if(0===a)for(const e of l)e._showDropTarget();a++})),o.addEvent(document.body,"dragleave.ui.editor",(e=>{if(a--,0===a)for(const e of l)e._resetDropText(),o.hide(e._dropTarget)})),o.addEvent(document.body,"dragend.ui.editor drop.ui.editor",(e=>{a=0})),o.addEvent(document,"selectionchange.ui.editor",o.debounce((()=>{const e=s();if(!e)return;const t=e.commonAncestorContainer;for(const s of l)o.isSame(s._editor,t)||o.hasDescendent(s._editor,t)?(s._lastRange=e,s._refreshCursor(),s._refreshToolbar()):s._removePopover()}))),o.addEvent(document,"beforeinput.ui.editor",(e=>{switch(e.inputType){case"historyUndo":case"historyRedo":break;default:return}for(const e of l)e._observe(!1)})),o.addEvent(document,"input.ui.editor",(e=>{switch(e.inputType){case"historyUndo":case"historyRedo":break;default:return}for(const e of l){if(o.isSame(e._editor,document.activeElement)){const{html:t}=e._history.at(-1);o.setHTML(e._editor,t),o.blur(e._editor)}e._observe()}}),{capture:!0}),o.addEvent(window,"click.ui.editor",(e=>{for(const e of l)e._removePopover()})),o.addEvent(window,"resize.ui.editor",o.debounce((e=>{for(const e of l)e._currentNode&&o.is(e._currentNode,"img")&&e._highlightImage(e._currentNode),e._refreshLineNumbers()}))),n=!0),o.triggerEvent(this._node,"init.ui.editor")}backColor(e){this._execCommand("backColor",e)}bold(){this._execCommand("bold")}disable(){o.setAttribute(this._node,{disabled:!0}),this._refreshDisabled(),this._refreshToolbar()}dispose(){l.delete(this),l.size||(o.removeEvent(document.body,"dragenter.ui.editor"),o.removeEvent(document.body,"dragleave.ui.editor"),o.removeEvent(document.body,"dragend.ui.editor"),o.removeEvent(document,"selectionchange.ui.editor"),o.removeEvent(document,"beforeinput.ui.editor"),o.removeEvent(document,"input.ui.editor"),o.removeEvent(window,"click.ui.editor"),o.removeEvent(window,"resize.ui.editor"),n=!1),this._popper&&(this._popper.dispose(),this._popper=null),this._modal&&(t.Modal.init(this._modal).dispose(),o.remove(this._modal),this._modal=null),this._fullScreen&&(t.Modal.init(this._fullScreen).dispose(),o.remove(this._fullScreen),this._fullScreen=null),this._observer.disconnect(),this._observer=null,this._observe=null,o.remove(this._container),o.show(this._node),o.removeAttribute(this._node,"tabindex"),this._buttons=null,this._container=null,this._toolbar=null,this._editorBody=null,this._editorContainer=null,this._editorScroll=null,this._editor=null,this._imgHighlight=null,this._imgCursor=null,this._imgResize=null,this._imgSize=null,this._sourceOuter=null,this._sourceContainer=null,this._sourceScroll=null,this._lineNumbers=null,this._source=null,this._popover=null,this._popoverArrow=null,this._popoverBody=null,this._dropTarget=null,this._dropText=null,this._resizeBar=null,this._currentNode=null,this._lastRange=null,this._history=null,this._redoHistory=null,super.dispose()}enable(){o.removeAttribute(this._node,"disabled"),this._refreshDisabled(),this._refreshToolbar()}fontName(e){this._execCommand("fontName",e)}fontSize(e){e=Object.keys(this.constructor.fontSizes).find((t=>this.constructor.fontSizes[t]===e)),this._execCommand("fontSize",e)}formatBlock(e){this._execCommand("formatBlock",e)}foreColor(e){this._execCommand("foreColor",e)}indent(){this._execCommand("indent")}insertHorizontalRule(){this._execCommand("insertHorizontalRule")}insertHTML(e){this._execCommand("insertHTML",e)}insertImage(e){const t=o.create("img",{attributes:{src:e}}),s=this._insertNode(t),i=new Image;i.onload=e=>{const t=o.width(this._editor,{boxSize:o.CONTENT_BOX}),r=Math.min(i.width,t);o.setStyle(s,"width",`${r}px`)},i.src=e}insertLink(e,t,s){const i=o.create("a",{text:t,attributes:{href:e}});s&&o.setAttribute(i,{target:"_blank"}),this._insertNode(i)}insertText(e){this._execCommand("insertText",e)}insertOrderedList(){this._execCommand("insertOrderedList")}insertUnorderedList(){this._execCommand("insertUnorderedList")}italic(){this._execCommand("italic")}justifyCenter(){this._execCommand("justifyCenter")}justifyFull(){this._execCommand("justifyFull")}justifyLeft(){this._execCommand("justifyLeft")}justifyRight(){this._execCommand("justifyRight")}outdent(){this._execCommand("outdent")}redo(){if(!this._redoHistory.length)return;const e=this._redoHistory.pop();this._addHistory(e),this._restoreHistory(e)}removeFormat(){this._execCommand("removeFormat")}strikethrough(){this._execCommand("strikethrough")}subscript(){this._execCommand("subscript")}superscript(){this._execCommand("superscript")}underline(){this._execCommand("underline")}undo(){if(this._history.length<=1)return;const e=this._history.pop();this._redoHistory.push(e);const t=this._history.at(-1);this._restoreHistory(t)}unlink(){this._execCommand("unlink")}}var c={alignCenter:{command:"justifyCenter"},alignJustify:{command:"justifyFull"},alignLeft:{command:"justifyLeft"},alignRight:{command:"justifyRight"},bold:{command:"bold"},color:{setContent(){const e=document.queryCommandValue("backColor"),t=document.queryCommandValue("foreColor"),s=o.create("span",{text:"A",class:this.constructor.classes.colorBtnContent,style:{color:t,backgroundColor:e}});return o.getProperty(s,"outerHTML")},dropdown(e){this._colorDropdown(e)}},font:{setContent(){const e=document.queryCommandValue("fontName").replace(/"/g,"");return this._options.fonts.includes(e)?e:this._options.defaultFont},dropdown(e){this._fontDropdown(e)}},fontSize:{setContent(){const e=document.queryCommandValue("fontSize");if(e)return this.constructor.fontSizes[e];const t=o.css(this._editor,"fontSize"),s=parseFloat(t);return Math.round(s)},dropdown(e){this._fontSizeDropdown(e)}},fullScreen:{action(){this._fullScreen?UI.Modal.init(this._fullScreen).hide():this._fullScreen=this.constructor._createModal({content:this._container,fullScreen:!0,onShown:e=>{o.isVisible(this._sourceContainer)?o.focus(this._source):o.focus(this._editor)},onHide:e=>{o.insertBefore(this._container,this._node),this._fullScreen=null}})}},hr:{command:"insertHorizontalRule"},image:{action(){this._showImageModal()}},indent:{command:"indent"},italic:{command:"italic"},link:{action(){this._showLinkModal()}},orderedList:{command:"insertOrderedList",disableCheck:()=>!["","p"].includes(document.queryCommandValue("formatBlock"))},outdent:{command:"outdent"},paragraph:{dropdown:[["alignLeft","alignCenter","alignRight","alignJustify"],["indent","outdent"]]},redo:{command:"redo",disableCheck(){return!this._redoHistory.length}},removeFormat:{command:"removeFormat"},source:{action(){o.isVisible(this._sourceContainer)?(this._showEditor(),o.focus(this._editor)):(this._showSource(),o.focus(this._source)),this._refreshToolbar()}},strikethrough:{command:"strikeThrough"},style:{dropdown(e){this._styleDropdown(e)},disableCheck:e=>document.queryCommandState("insertOrderedList")||document.queryCommandState("insertUnorderedList")},subscript:{command:"subscript"},superscript:{command:"superscript"},table:{dropdown(e){this._tableDropdown(e)}},underline:{command:"underline"},undo:{command:"undo",disableCheck(){return!this._history.length}},unlink:{command:"unlink"},unorderedList:{command:"insertUnorderedList",disableCheck:()=>!["","p"].includes(document.queryCommandValue("formatBlock"))},video:{action(){this._showVideoModal()}}},h={floatLeft:{action(e){o.setStyle(e,{float:"left"})}},floatRight:{action(e){o.setStyle(e,{float:"right"})}},floatNone:{action(e){o.removeStyle(e,"float")}},imageFull:{content:"100%",action(e){o.setStyle(e,{width:"100%"})}},imageHalf:{content:"50%",action(e){o.setStyle(e,{width:"50%"})}},imageQuarter:{content:"25%",action(e){o.setStyle(e,{width:"25%"})}},imageOriginal:{action(e){o.removeStyle(e,"width")}},imageRemove:{action(e){o.detach(e),this._removePopover()}},link:{render(e){const t=o.getAttribute(e,"href");return o.create("a",{text:t,class:this.constructor.classes.linkUrl,attributes:{href:t,target:"_blank"}})}},linkEdit:{action(e){this._showLinkModal(e)}},tableColumnAfter:{action(e){this._updateTable(e,((e,t,s)=>{const i=o.index(e),r=o.find(":scope > thead > tr, :scope > tbody > tr",s);this._observe(!1);for(const e of r){const t=o.create("td",{html:"<br>"}),s=o.children(e,"th, td");o.after(s[i],t)}this._observe(),this._updateValue()}))}},tableColumnBefore:{action(e){this._updateTable(e,((e,t,s)=>{const i=o.index(e),r=o.find(":scope > thead > tr, :scope > tbody > tr",s);this._observe(!1);for(const e of r){const t=o.create("td",{html:"<br>"}),s=o.children(e,"th, td");o.before(s[i],t)}this._observe(),this._updateValue()}))}},tableColumnRemove:{action(e){this._updateTable(e,((e,t,s)=>{const i=o.index(e),r=o.find(":scope > thead > tr, :scope > tbody > tr",s);this._observe(!1);for(const e of r){const t=o.children(e,"th, td");o.remove(t[i])}this._observe(),this._updateValue(),this._removePopover()}))}},tableRemove:{action(e){const t=o.closest(e,"table",this._editor).shift();o.detach(t),this._removePopover()}},tableRowAfter:{action(e){this._updateTable(e,((e,t)=>{const s=o.children(t).length,i=o.create("tr");for(let e=0;e<s;e++){const e=o.create("td",{html:"<br>"});o.append(i,e)}o.after(t,i)}))}},tableRowBefore:{action(e){this._updateTable(e,((e,t)=>{const s=o.children(t).length,i=o.create("tr");for(let e=0;e<s;e++){const e=o.create("td",{html:"<br>"});o.append(i,e)}o.before(t,i)}))}},tableRowRemove:{action(e){this._updateTable(e,((e,t)=>{o.remove(t),this._removePopover()}))}},unlink:{action(e){o.select(e),this.unlink(),s().collapse()}}};function u(e,t){let s=t;for(const t of e)s=o.contents(s)[t];return s}function p(e,t){return o.isSame(e,t)?[]:[...o.parents(e,null,t),e].map((e=>o.contents(o.parent(e).shift()).indexOf(e)))}const m="rgba(0, 0, 0, 0)",v=e=>o._isText(e)||o.is(e,"a, abbr, area, audio, b, bdi, bdo, br, button, cite, code, data, datalist, del, dfn, em, embed, i, iframe, img, input, ins, kbd, label, map, mark, math, meter, noscript, object, output, picture, progress, q, ruby, s, samp, script, select, slot, small, span, strong, sub, sup, svg, template, textarea, time, u, var, video, wbr"),g=e=>!o._isText(e)&&v(e)&&!(e=>o.is(e,"area, base, br, col, embed, hr, img, input, link, meta, param, source, track, wbr"))(e)&&!(e=>o.is(e,"button, fieldset, input, object, output, select, textarea"))(e);d.defaults={buttons:null,popovers:{image:[["imageFull","imageHalf","imageQuarter","imageOriginal"],["floatLeft","floatRight","floatNone"],["imageRemove"]],link:["link",["linkEdit"],["unlink"]],table:[["tableRowAfter","tableRowBefore","tableColumnBefore","tableColumnAfter"],["tableRowRemove","tableColumnRemove","tableRemove"]]},imageUpload(e){const t=[];for(const o of e)t.push(new Promise(((e,t)=>{const s=new FileReader;s.onload=t=>{e(s.result)},s.onerror=e=>{t(new Error("Unable to read file"))},s.readAsDataURL(o)})));Promise.allSettled(t).then((e=>{for(const t of e)"fulfilled"===t.status&&this.insertImage(t.value)}))},keyDown(e){if(!e.ctrlKey)return;let t;switch(e.key){case"b":t="bold";break;case"i":t="italic";break;case"u":t="underline";break;case"y":t="redo";break;case"z":t="undo";break;default:return}e.preventDefault(),this[t]()},defaultFont:"Arial",fonts:null,height:"auto",resizable:!0,historyLimit:1e3},d.classes={btn:"btn btn-editor btn-sm fs-6 lh-1",btnGroup:"btn-group me-1 mb-1",btnIcon:"pe-none",checkbox:"input-check",checkboxContainer:"form-check",color:"editor-color flex-grow-1 d-block border-0",colorBtnContent:"fw-bold d-inline-block px-1 pe-none",colorContainerRow:"row g-0",colorContainerColumn:"col-6",colorDefaultBtn:"btn btn-outline-editor btn-sm d-block w-100 py-0",colorLabel:"d-block text-center",colorLabelContainer:"p-2",colorRow:"d-flex flex-row px-2",container:"card overflow-hidden shadow-sm",dropdown:"dropdown-menu",dropdownButtons:"pt-2 pe-1 pb-1 ps-2 text-nowrap",dropdownGroup:"btn-group",dropdownItem:"dropdown-item",dropdownItemDisabled:"disabled",dropdownToggle:"dropdown-toggle",dropHover:"text-primary",dropTarget:"editor-drop-target position-absolute w-100 text-center",dropText:"position-absolute top-50 translate-middle h5 pe-none",editor:"editor w-100 p-2 outline-0",editorBody:"card-body d-flex p-0",editorContainer:"editor-container position-relative",editorDisabled:"bg-body-tertiary pe-none",editorScroll:"editor-scroll d-block w-100 overflow-auto",formError:"form-error",formGroup:"mb-2",imgCursor:"editor-img-cursor position-absolute translate-middle pe-none",imgHighlight:"editor-img-highlight position-absolute pe-none",imgResize:"editor-img-resize position-absolute top-100 start-100 translate-middle pe-auto",imgSize:"editor-img-size position-absolute bottom-0 end-0 text-end me-2 mb-2 py-1 px-3 rounded",input:"input-filled",inputContainer:"form-input",inputRipple:"ripple-line",invalidFeedback:"invalid-feedback",linkUrl:"editor-link-url d-inline-block text-truncate me-1",modal:"modal",modalBody:"modal-body",modalBtnClose:"btn-close",modalBtnPrimary:"btn btn-primary ripple mb-0",modalBtnSecondary:"btn btn-secondary ripple mb-0",modalContent:"modal-content shadow",modalDialog:"modal-dialog",modalFooter:"modal-footer",modalFullscreen:"modal-fullscreen",modalHeader:"modal-header",modalTitle:"modal-title",popover:"editor-popover popover",popoverArrow:"popover-arrow",popoverBody:"popover-body mb-n1 ms-n2 me-n3",resizeBar:"editor-resize card-footer",source:"editor-source font-monospace outline-0 border-0 p-2 mb-0 w-100",sourceContainer:"d-flex h-100",sourceLines:"font-monospace bg-body-secondary p-2 mb-0 border-end",sourceOuter:"w-100 overflow-hidden",sourceScroll:"d-flex w-100",styleContent:"mb-1",table:"table table-bordered",tableCell:"flex-column",tableDropdown:"p-2",tableHover:"bg-primary",tableInfo:"text-muted",tableLink:"editor-table-link d-block border border-dark p-2 rounded-0",tableRow:"d-flex flex-row",toolbar:"card-header pt-1 pe-0 pb-0 ps-1",toolbarButtons:"btn-toolbar"},d.lang={drop:{drop:"Drop image or text",dropHere:"Drop image or text here"},dropdowns:{colorBackground:"Background Color",colorDefault:"Use Default",colorForeground:"Foreground Color",colorTransparent:"Use Transparent"},modals:{cancel:"Cancel",close:"Close",imageFile:"Select Files",imageUrl:"Image URL",insertImage:"Insert Image",insertLink:"Insert Link",insertVideo:"Insert Video",linkNewWindow:"Open in new window",linkText:"Link Text",linkUrl:"Link URL",videoUrl:"Video URL",videoUrlInvalid:"Invalid video URL."},plugins:{alignCenter:"Align Center",alignJustify:"Justify Full",alignLeft:"Align Left",alignRight:"Align Right",bold:"Bold",color:"Font Color",font:"Font Family",fontSize:"Font Size",fullScreen:"Full Screen",hr:"Horizontal Rule",image:"Image",indent:"Indent",italic:"Italic",link:"Link",orderedList:"Ordered List",outdent:"Outdent",paragraph:"Paragraph",redo:"Redo",removeFormat:"Remove Formatting",source:"View Source",strikethrough:"Strikethrough",style:"Style",subscript:"Subscript",superscript:"Superscript",table:"Table",underline:"Underline",undo:"Undo",unlink:"Unlink",unorderedList:"Unordered List",video:"Video"},popovers:{imageFull:"Full Size",imageHalf:"Half Size",imageOriginal:"Original Size",imageQuarter:"Quarter Size",imageRemove:"Remove Image",floatLeft:"Float Left",floatNone:"Remove Float",floatRight:"Float Right",linkEdit:"Edit Link",tableColumnAfter:"Add Column After",tableColumnBefore:"Add Column Before",tableColumnRemove:"Remove Column",tableRemove:"Remove Table",tableRowAfter:"Add Row After",tableRowBefore:"Add Row Before",tableRowRemove:"Remove Row",unlink:"Remove Link"},styles:{p:"Paragraph",blockquote:"Quote",pre:"Code",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"}},d.buttons=[["style"],["bold","italic","underline","removeFormat"],["font"],["color"],["unorderedList","orderedList","paragraph"],["table"],["link","image","video"],["fullScreen","source"]],d.colors=[{Black:"#000000",Tundora:"#424242","Dove Gray":"#636363","Star Dust":"#9C9C94","Pale Slate":"#CEC6CE",Gallery:"#EFEFEF",Alabaster:"#F7F7F7",White:"#FFFFFF"},{Red:"#FF0000","Orange Peel":"#FF9C00",Yellow:"#FFFF00",Green:"#00FF00",Cyan:"#00FFFF",Blue:"#0000FF","Electric Violet":"#9C00FF",Magenta:"#FF00FF"},{Azalea:"#F7C6CE",Karry:"#FFE7CE","Egg White":"#FFEFC6",Zanah:"#D6EFD6",Botticelli:"#CEDEE7","Tropical Blue":"#CEE7F7",Mischka:"#D6D6E7",Twilight:"#E7D6DE"},{"Tonys Pink":"#E79C9C","Peach Orange":"#FFC69C","Cream Brulee":"#FFE79C",Sprout:"#B5D6A5",Casper:"#A5C6CE",Perano:"#9CC6EF","Cold Purple":"#B5A5D6","Careys Pink":"#D6A5BD"},{Mandy:"#E76363",Rajah:"#F7AD6B",Dandelion:"#FFD663",Olivine:"#94BD7B","Gulf Stream":"#73A5AD",Viking:"#6BADDE","Blue Marguerite":"#8C7BC6",Puce:"#C67BA5"},{"Guardsman Red":"#CE0000","Fire Bush":"#E79439","Golden Dream":"#EFC631","Chelsea Cucumber":"#6BA54A","Smalt Blue":"#4A7B8C","Boston Blue":"#3984C6","Butterfly Bush":"#634AA5",Cadillac:"#A54A7B"},{Sangria:"#9C0000","Mai Tai":"#B56308","Buddha Gold":"#BD9400","Forest Green":"#397B21",Eden:"#104A5A","Venice Blue":"#085294",Meteorite:"#311873",Claret:"#731842"},{Rosewood:"#630000",Cinnamon:"#7B3900",Olive:"#846300",Parsley:"#295218",Tiber:"#083139","Midnight Blue":"#003163",Valentino:"#21104A",Loulou:"#4A1031"}],d.fonts=["Arial","Arial Black","Comic Sans MS","Courier New","Garamond","Georgia","Helvetica","Impact","Tahoma","Times New Roman","Trebuchet MS","Verdana"],d.fontSizes={1:8,2:13,3:16,4:18,5:24,6:32,7:48},d.icons={alignCenter:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M3 3h18v2H3V3m4 4h10v2H7V7m-4 4h18v2H3v-2m4 4h10v2H7v-2m-4 4h18v2H3v-2z" fill="currentColor"/></svg>',alignJustify:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M3 3h18v2H3V3m0 4h18v2H3V7m0 4h18v2H3v-2m0 4h18v2H3v-2m0 4h18v2H3v-2z" fill="currentColor"/></svg>',alignLeft:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M3 3h18v2H3V3m0 4h12v2H3V7m0 4h18v2H3v-2m0 4h12v2H3v-2m0 4h18v2H3v-2z" fill="currentColor"/></svg>',alignRight:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M3 3h18v2H3V3m6 4h12v2H9V7m-6 4h18v2H3v-2m6 4h12v2H9v-2m-6 4h18v2H3v-2z" fill="currentColor"/></svg>',bold:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M13.5 15.5H10v-3h3.5A1.5 1.5 0 0 1 15 14a1.5 1.5 0 0 1-1.5 1.5m-3.5-9h3A1.5 1.5 0 0 1 14.5 8A1.5 1.5 0 0 1 13 9.5h-3m5.6 1.29c.97-.68 1.65-1.79 1.65-2.79c0-2.26-1.75-4-4-4H7v14h7.04c2.1 0 3.71-1.7 3.71-3.79c0-1.52-.86-2.82-2.15-3.42z" fill="currentColor"/></svg>',floatLeft:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M3 7h6v6H3V7m0-4h18v2H3V3m18 4v2H11V7h10m0 4v2H11v-2h10M3 15h14v2H3v-2m0 4h18v2H3v-2z" fill="currentColor"/></svg>',floatNone:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M3 7h6v6H3V7m0-4h18v2H3V3m18 8v2H11v-2h10M3 15h14v2H3v-2m0 4h18v2H3v-2z" fill="currentColor"/></svg>',floatRight:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M15 7h6v6h-6V7M3 3h18v2H3V3m10 4v2H3V7h10m-4 4v2H3v-2h6m-6 4h14v2H3v-2m0 4h18v2H3v-2z" fill="currentColor"/></svg>',fullScreen:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M9.5 13.09l1.41 1.41l-4.5 4.5H10v2H3v-7h2v3.59l4.5-4.5m1.41-3.59L9.5 10.91L5 6.41V10H3V3h7v2H6.41l4.5 4.5m3.59 3.59l4.5 4.5V14h2v7h-7v-2h3.59l-4.5-4.5l1.41-1.41M13.09 9.5l4.5-4.5H14V3h7v7h-2V6.41l-4.5 4.5l-1.41-1.41z" fill="currentColor"/></svg>',hr:'<span class="d-block" style="width: 12px; border-bottom: 2px solid currentColor;"></span>',image:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M8.5 13.5l2.5 3l3.5-4.5l4.5 6H5m16 1V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z" fill="currentColor"/></svg>',imageOriginal:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 8c-3.56 0-5.35 4.31-2.83 6.83C11.69 17.35 16 15.56 16 12c0-2.21-1.79-4-4-4m-7 7H3v4c0 1.1.9 2 2 2h4v-2H5M5 5h4V3H5c-1.1 0-2 .9-2 2v4h2m14-6h-4v2h4v4h2V5c0-1.1-.9-2-2-2m0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2" fill="currentColor"/></svg>',imageRemove:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M5 3c-1.1 0-2 .9-2 2v14a2 2 0 0 0 2 2h9.09c-.06-.33-.09-.66-.09-1c0-.68.12-1.36.35-2H5l3.5-4.5l2.5 3l3.5-4.5l2.23 2.97c.97-.63 2.11-.97 3.27-.97c.34 0 .67.03 1 .09V5a2 2 0 0 0-2-2H5m11.47 14.88L18.59 20l-2.12 2.12l1.41 1.42L20 21.41l2.12 2.13l1.42-1.42L21.41 20l2.13-2.12l-1.42-1.42L20 18.59l-2.12-2.12l-1.42 1.41z" fill="currentColor"/></svg>',indent:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M11 13h10v-2H11m0-2h10V7H11M3 3v2h18V3M11 17h10v-2H11M3 8v8l4-4m-4 9h18v-2H3v2z" fill="currentColor"/></svg>',italic:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4h-8z" fill="currentColor"/></svg>',link:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5a5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1c0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5a5 5 0 0 0-5-5z" fill="currentColor"/></svg>',linkEdit:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M5 3c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7H5V5h7V3H5m12.78 1a.69.69 0 0 0-.48.2l-1.22 1.21l2.5 2.5L19.8 6.7c.26-.26.26-.7 0-.95L18.25 4.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L8 13.5V16h2.5l7.37-7.38l-2.5-2.5z" fill="currentColor"/></svg>',orderedList:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M7 13v-2h14v2H7m0 6v-2h14v2H7M7 7V5h14v2H7M3 8V5H2V4h2v4H3m-1 9v-1h3v4H2v-1h2v-.5H3v-1h1V17H2m2.25-7a.75.75 0 0 1 .75.75c0 .2-.08.39-.21.52L3.12 13H5v1H2v-.92L4 11H2v-1h2.25z" fill="currentColor"/></svg>',outdent:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M11 13h10v-2H11m0-2h10V7H11M3 3v2h18V3M3 21h18v-2H3m0-7l4 4V8m4 9h10v-2H11v2z" fill="currentColor"/></svg>',paragraph:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M10 11a4 4 0 0 1-4-4a4 4 0 0 1 4-4h8v2h-2v16h-2V5h-2v16h-2V11z" fill="currentColor"/></svg>',redo:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M18.4 10.6C16.55 9 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16a8.002 8.002 0 0 1 7.6-5.5c1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z" fill="currentColor"/></svg>',removeFormat:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M6 5v.18L8.82 8h2.4l-.72 1.68l2.1 2.1L14.21 8H20V5H6M3.27 5L2 6.27l6.97 6.97L6.5 19h3l1.57-3.66L16.73 21L18 19.73L3.55 5.27L3.27 5z" fill="currentColor"/></svg>',source:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M14.6 16.6l4.6-4.6l-4.6-4.6L16 6l6 6l-6 6l-1.4-1.4m-5.2 0L4.8 12l4.6-4.6L8 6l-6 6l6 6l1.4-1.4z" fill="currentColor"/></svg>',strikethrough:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M3 14h18v-2H3m2-8v3h5v3h4V7h5V4m-9 15h4v-3h-4v3z" fill="currentColor"/></svg>',style:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M18.5 4l1.16 4.35l-.96.26c-.45-.87-.91-1.74-1.44-2.18C16.73 6 16.11 6 15.5 6H13v10.5c0 .5 0 1 .33 1.25c.34.25 1 .25 1.67.25v1H9v-1c.67 0 1.33 0 1.67-.25c.33-.25.33-.75.33-1.25V6H8.5c-.61 0-1.23 0-1.76.43c-.53.44-.99 1.31-1.44 2.18l-.96-.26L5.5 4h13z" fill="currentColor"/></svg>',superscript:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M16 7.41L11.41 12L16 16.59L14.59 18L10 13.41L5.41 18L4 16.59L8.59 12L4 7.41L5.41 6L10 10.59L14.59 6L16 7.41M21.85 9h-4.88V8l.89-.82c.76-.64 1.32-1.18 1.7-1.63c.37-.44.56-.85.57-1.23a.884.884 0 0 0-.27-.7c-.18-.19-.47-.28-.86-.29c-.31.01-.58.07-.84.17l-.66.39l-.45-1.17c.27-.22.59-.39.98-.53S18.85 2 19.32 2c.78 0 1.38.2 1.78.61c.4.39.62.93.62 1.57c-.01.56-.19 1.08-.54 1.55c-.34.48-.76.93-1.27 1.36l-.64.52v.02h2.58V9z" fill="currentColor"/></svg>',table:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M5 4h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2m0 4v4h6V8H5m8 0v4h6V8h-6m-8 6v4h6v-4H5m8 0v4h6v-4h-6z" fill="currentColor"/></svg>',tableColumnAfter:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M11 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2V2h9m-7 8v4h7v-4H4m0 6v4h7v-4H4M4 4v4h7V4H4m11 7h3V8h2v3h3v2h-3v3h-2v-3h-3v-2z" fill="currentColor"/></svg>',tableColumnBefore:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M13 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h9V2h-9m7 8v4h-7v-4h7m0 6v4h-7v-4h7m0-12v4h-7V4h7M9 11H6V8H4v3H1v2h3v3h2v-3h3v-2z" fill="currentColor"/></svg>',tableColumnRemove:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M4 2h7a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 8v4h7v-4H4m0 6v4h7v-4H4M4 4v4h7V4H4m13.59 8L15 9.41L16.41 8L19 10.59L21.59 8L23 9.41L20.41 12L23 14.59L21.59 16L19 13.41L16.41 16L15 14.59L17.59 12z" fill="currentColor"/></svg>',tableRemove:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M15.46 15.88l1.42-1.42L19 16.59l2.12-2.13l1.42 1.42L20.41 18l2.13 2.12l-1.42 1.42L19 19.41l-2.12 2.13l-1.42-1.42L17.59 18l-2.13-2.12M4 3h14a2 2 0 0 1 2 2v7.08a6.01 6.01 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2m0 4v4h6V7H4m8 0v4h6V7h-6m-8 6v4h6v-4H4z" fill="currentColor"/></svg>',tableRowAfter:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M22 10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V3h2v2h4V3h2v2h4V3h2v2h4V3h2v7M4 10h4V7H4v3m6 0h4V7h-4v3m10 0V7h-4v3h4m-9 4h2v3h3v2h-3v3h-2v-3H8v-2h3v-3z" fill="currentColor"/></svg>',tableRowBefore:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M22 14a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v7h2v-2h4v2h2v-2h4v2h2v-2h4v2h2v-7M4 14h4v3H4v-3m6 0h4v3h-4v-3m10 0v3h-4v-3h4m-9-4h2V7h3V5h-3V2h-2v3H8v2h3v3z" fill="currentColor"/></svg>',tableRowRemove:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M9.41 13L12 15.59L14.59 13L16 14.41L13.41 17L16 19.59L14.59 21L12 18.41L9.41 21L8 19.59L10.59 17L8 14.41L9.41 13M22 9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v3M4 9h4V6H4v3m6 0h4V6h-4v3m6 0h4V6h-4v3z" fill="currentColor"/></svg>',underline:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M5 21h14v-2H5v2m7-4a6 6 0 0 0 6-6V3h-2.5v8a3.5 3.5 0 0 1-3.5 3.5A3.5 3.5 0 0 1 8.5 11V3H6v8a6 6 0 0 0 6 6z" fill="currentColor"/></svg>',undo:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12.5 8c-2.65 0-5.05 1-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88c3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z" fill="currentColor"/></svg>',unlink:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1c0 1.43-.98 2.63-2.31 3l1.46 1.44C20.88 15.61 22 13.95 22 12a5 5 0 0 0-5-5m-1 4h-2.19l2 2H16v-2M2 4.27l3.11 3.11A4.991 4.991 0 0 0 2 12a5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1c0-1.59 1.21-2.9 2.76-3.07L8.73 11H8v2h2.73L13 15.27V17h1.73l4.01 4L20 19.74L3.27 3L2 4.27z" fill="currentColor"/></svg>',unorderedList:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M7 5h14v2H7V5m0 8v-2h14v2H7M4 4.5A1.5 1.5 0 0 1 5.5 6A1.5 1.5 0 0 1 4 7.5A1.5 1.5 0 0 1 2.5 6A1.5 1.5 0 0 1 4 4.5m0 6A1.5 1.5 0 0 1 5.5 12A1.5 1.5 0 0 1 4 13.5A1.5 1.5 0 0 1 2.5 12A1.5 1.5 0 0 1 4 10.5M7 19v-2h14v2H7m-3-2.5A1.5 1.5 0 0 1 5.5 18A1.5 1.5 0 0 1 4 19.5A1.5 1.5 0 0 1 2.5 18A1.5 1.5 0 0 1 4 16.5z" fill="currentColor"/></svg>',video:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M17 10.5V7a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-3.5l4 4v-11l-4 4z" fill="currentColor"/></svg>'},d.plugins=c,d.popovers=h,d.styles=["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],d._createCheckbox=function(e){const t=o.create("div",{class:this.classes.formGroup}),s=o.create("div",{class:this.classes.checkboxContainer}),i=o.create("input",{class:this.classes.checkbox,attributes:{id:e.id,type:"checkbox",...e.attributes}}),r=o.create("label",{text:e.label,attributes:{for:e.id}});return o.append(s,i),o.append(s,r),o.append(t,s),{group:t,input:i}},d._createFileInput=function(e){const t=o.create("div",{class:this.classes.formGroup}),s=o.create("label",{text:e.label,attributes:{for:e.id}}),i=o.create("div",{class:this.classes.inputContainer}),r=o.create("input",{attributes:{id:e.id,type:"file",...e.attributes}});return o.append(t,s),o.append(i,r),o.append(t,i),{group:t,input:r}},d._createInput=function(e){const t=o.create("div",{class:this.classes.formGroup}),s=o.create("label",{text:e.label,attributes:{for:e.id}}),i=o.create("div",{class:this.classes.inputContainer}),r=o.create("input",{class:this.classes.input,attributes:{id:e.id,type:e.type||"text",...e.attributes}}),n=o.create("div",{class:this.classes.inputRipple}),a=o.create("div",{class:this.classes.invalidFeedback});return o.append(t,s),o.append(i,r),o.append(i,n),o.append(t,i),o.append(t,a),{group:t,input:r,invalidFeedback:a}},d._createModal=function(e){const s=o.create("div",{class:this.classes.modal,attributes:{tabindex:-1,role:"dialog","aria-model":!0}}),i=o.create("div",{class:this.classes.modalDialog});o.append(s,i),e.fullScreen&&o.addClass(i,this.classes.modalFullscreen);const r=o.create("form",{class:this.classes.modalContent});o.append(i,r);const n=o.create("div",{class:this.classes.modalHeader});if(o.append(r,n),e.title){const t=o.create("h6",{class:this.classes.modalTitle,text:e.title});o.append(n,t)}const a=o.create("button",{class:this.classes.modalBtnClose,dataset:{uiDismiss:"modal"},attributes:{type:"button","aria-label":this.lang.modals.close}});if(o.append(n,a),e.content){const t=o.create("div",{class:this.classes.modalBody});o.append(t,e.content),o.append(r,t)}if(e.onSubmit){const i=o.create("div",{class:this.classes.modalFooter});o.append(r,i);const n=o.create("button",{text:e.cancelText,class:this.classes.modalBtnSecondary,dataset:{uiDismiss:"modal"},attributes:{type:"button"}});o.append(i,n);const a=o.create("button",{text:e.submitText,class:this.classes.modalBtnPrimary,attributes:{type:"submit"}});o.append(i,a),o.addEvent(r,"submit",(o=>{o.preventDefault(),!1!==e.onSubmit(o)&&t.Modal.init(s).hide()}))}return o.append(document.body,s),"onShow"in e&&o.addEvent(s,"show.ui.modal",(t=>{e.onShow(t)})),"onShown"in e&&o.addEvent(s,"shown.ui.modal",(t=>{e.onShown(t)})),"onHide"in e&&o.addEvent(s,"hide.ui.modal",(t=>{e.onHide(t)})),"onHidden"in e&&o.addEvent(s,"hidden.ui.modal",(t=>{e.onHidden(t)})),t.Modal.init(s).show(),s};const f=d.prototype;f._addHistory=function({html:e,selectionData:t=null}={}){for(this._history.push({html:e,selectionData:t});this._history.length>this._options.historyLimit;)this._history.shift()},f._checkEmpty=function(){o.getValue(this._node).trim()||o.setHTML(this._editor,"<p><br></p>")},f._colorDropdown=function(e){const s=o.create("li",{class:this.constructor.classes.colorContainerRow}),i=o.create("div",{class:this.constructor.classes.colorContainerColumn}),r=o.create("div",{class:this.constructor.classes.colorContainerColumn}),n=o.create("small",{text:this.constructor.lang.dropdowns.colorForeground,class:this.constructor.classes.colorLabel}),a=o.create("small",{text:this.constructor.lang.dropdowns.colorBackground,class:this.constructor.classes.colorLabel});o.append(i,n),o.append(r,a);const l=o.create("div",{class:this.constructor.classes.colorLabelContainer});o.append(i,l);const d=o.create("div",{class:this.constructor.classes.colorLabelContainer});o.append(r,d);const c=o.create("button",{text:this.constructor.lang.dropdowns.colorDefault,class:this.constructor.classes.colorDefaultBtn,attributes:{type:"button"}});o.append(l,c),this._setToolbarData(c,{command:"foreColor",value:"initial"});const h=o.create("button",{text:this.constructor.lang.dropdowns.colorTransparent,class:this.constructor.classes.colorDefaultBtn,attributes:{type:"button"}});o.append(d,h),this._setToolbarData(h,{command:"backColor",value:"initial"});for(const e of this.constructor.colors){const s=o.create("div",{class:this.constructor.classes.colorRow});o.append(i,s);const n=o.create("div",{class:this.constructor.classes.colorRow});o.append(r,n);for(const[i,r]of Object.entries(e)){const e=o.create("button",{class:this.constructor.classes.color,style:{backgroundColor:r},attributes:{"data-ui-title":i,type:"button","aria-label":i}});o.append(s,e),t.Tooltip.init(e,{appendTo:document.body,placement:"bottom"}),this._setToolbarData(e,{command:"foreColor",value:r});const a=o.create("button",{class:this.constructor.classes.color,style:{backgroundColor:r},attributes:{"data-ui-title":i,type:"button","aria-label":i}});o.append(n,a),UI.Tooltip.init(a,{appendTo:document.body,placement:"bottom"}),this._setToolbarData(a,{command:"backColor",value:r})}}o.append(s,i),o.append(s,r),o.setStyle(e,{minWidth:"350px"}),o.append(e,s)},f._events=function(){this._eventsToolbar(),this._eventsEditor(),this._eventsPopover(),this._eventsSource(),this._eventsDrop(),this._options.resizable&&this._eventsResize()},f._eventsDrop=function(){o.addEventDelegate(this._editor,"dragstart.ui.editor","img",(e=>{e.preventDefault()})),o.addEvent(this._dropTarget,"dragenter.ui.editor",(e=>{o.addClass(this._dropText,this.constructor.classes.dropHover),o.setText(this._dropText,this.constructor.lang.drop.drop),o.show(this._dropTarget)})),o.addEvent(this._dropTarget,"dragleave.ui.editor",(e=>{this._resetDropText()})),o.addEvent(this._dropTarget,"dragover.ui.editor",(e=>{e.preventDefault()})),o.addEvent(this._dropTarget,"drop.ui.editor",(e=>{if(e.preventDefault(),a=0,this._resetDropText(),o.hide(this._dropTarget),e.dataTransfer.files.length)this._options.imageUpload.bind(this)(e.dataTransfer.files);else{const t=e.dataTransfer.getData("text");this.insertText(t)}}))},f._eventsEditor=function(){o.addEvent(this._editor,"focus.ui.editor",(e=>{o.triggerEvent(this._node,"focus.ui.editor")})),o.addEvent(this._editor,"blur.ui.editor",(e=>{o.triggerEvent(this._node,"blur.ui.editor")})),o.addEvent(this._editor,"input.ui.editor",(e=>{switch(e.inputType){case"historyUndo":if(!o.isSame(document.activeElement,this._editor))return;this.undo();break;case"historyRedo":if(!o.isSame(document.activeElement,this._editor))return;this.redo()}"insertText"!==e.inputType&&this._normalize(),this._updateValue(),this._checkEmpty()})),o.addEvent(this._editor,"keydown.ui.editor",(e=>{switch(this._options.keyDown&&this._options.keyDown.bind(this)(e),e.code){case"Backspace":o.contents(this._editor).length<=1&&""===o.getText(this._editor)&&e.preventDefault();break;case"Delete":const t=window.getSelection();if(t.isCollapsed&&o.isSame(t.anchorNode,t.focusNode)&&""===o.getText(t.anchorNode)){const e=[t.anchorNode,...o.parents(t.anchorNode,null,this._editor)];if(e.every((e=>o.contents(e).length<=1))){const t=e.pop(),s=o.next(t).shift();let i="p";s&&o.is(s,"h1, h2, h3, h4, h5, h6, pre")&&(i=o.tagName(s)),this._observe(!1),this._execCommand("formatBlock",i),this._observe()}}}})),o.addEvent(this._editorContainer,"click.ui.editor",(e=>{o.focus(this._editor)})),o.addEventDelegate(this._editor,"click.ui.editor","a, td, img",(e=>{e.preventDefault(),e.stopPropagation(),this._refreshPopover(e.currentTarget,e),this._refreshToolbar()}),{capture:!0});const e=()=>{this._normalize(),this._updateValue(),this._checkEmpty()};this._observer=new MutationObserver(e);let t=0,s=[];this._observe=(o=!0)=>{o?(t++,1===t&&(this._observer.observe(this._editor,{attributes:!0,childList:!0,subtree:!0}),s.length&&(e(),s=[]))):(t--,0===t&&(this._observer.disconnect(),s=this._observer.takeRecords()))},this._observe()},f._eventsPopover=function(){o.addEventDelegate(this._popover,"click.ui.editor","[data-ui-action]",(e=>{const t=o.getDataset(e.currentTarget,"uiAction");if(!(t in this.constructor.popovers))throw new Error(`Unknown action ${t}`);e.preventDefault(),this.constructor.popovers[t].action.bind(this)(this._currentNode),this._refreshPopover(this._currentNode)}));const e=o.mouseDragFactory((e=>{if(!this._currentNode||!o.is(this._currentNode,"img"))return!1;e.stopPropagation(),o.hide(this._imgCursor),o.hide(this._popover),this._observe(!1)}),(e=>{const t=o.rect(this._currentNode,{offset:!0}),s=t.width/t.height,i=Math.max(e.pageX-t.x,(e.pageY-t.y)*s,1);o.setStyle(this._currentNode,{width:`${Math.round(i)}px`}),this._highlightImage(this._currentNode)}),(e=>{i(this._currentNode),s().collapse(!1),this._updateValue(),this._observe()}));o.addEvent(this._imgResize,"mousedown.ui.editor",e),o.addEvent(this._editorBody,"scroll.ui.editor",(e=>{this._removePopover()}))},f._eventsResize=function(){let e=0;const t=o.mouseDragFactory((t=>{const s=o.position(this._resizeBar,{offset:!0});e=t.pageY-s.y,this._removePopover()}),(t=>{const s=o.position(this._editorBody,{offset:!0}),i=Math.max(0,t.pageY-s.y-e);o.setStyle(this._editorBody,{height:`${i}px`})}),(t=>{e=0}));o.addEvent(this._resizeBar,"mousedown.ui.editor",t)},f._eventsSource=function(){const e=o.debounce((e=>{this._refreshLineNumbers()}));o.addEvent(this._source,"input.ui.editor",(t=>{e()})),o.addEvent(this._source,"change.ui.editor",(t=>{const s=o.getValue(this._source);e(),this._addHistory({html:s}),o.setHTML(this._editor,s),o.setValue(this._node,s),o.triggerEvent(this._node,"change.ui.editor")})),o.addEvent(this._source,"keydown.ui.editor",(e=>{if("Tab"!==e.key)return;e.preventDefault();const t=o.getProperty(this._source,"selectionStart"),s=o.getProperty(this._source,"selectionEnd"),i=o.getValue(this._source),r=i.split("\n"),n=i.substring(0,t).split("\n").length-1,a=i.substring(0,s).split("\n").length-1;let l,d=t,c=s;if(e.shiftKey){for(const[e,t]of r.entries())e>=n&&e<=a&&t.startsWith("\t")&&(r[e]=t.substring(1),e===n&&d--,e<a&&c--);l=r.join("\n")}else if(n!==a){for(const[e,t]of r.entries())e>=n&&e<=a&&(e<a||r[e])&&(r[e]="\t"+t,e<a&&c++);l=r.join("\n")}else l=i.substring(0,t)+"\t"+i.substring(s),d++,t===s?c++:c=d;o.select(this._source),document.execCommand("insertText",!1,l),this._source.setSelectionRange(d,c)})),o.addEvent(this._source,"scroll.ui.editor",o.debounce((e=>{const t=o.getScrollY(this._source);o.setStyle(this._lineNumbers,{marginTop:-t+"px"})})))},f._eventsToolbar=function(){o.addEventDelegate(this._toolbar,"click.ui.editor","[data-ui-action]",(e=>{const t=o.getDataset(e.currentTarget,"uiAction");if(!(t in this.constructor.plugins))throw new Error(`Unknown action ${t}`);if(e.preventDefault(),this._lastRange){const e=window.getSelection();e.removeAllRanges(),e.addRange(this._lastRange)}this.constructor.plugins[t].action.bind(this)()})),o.addEventDelegate(this._toolbar,"click.ui.editor","[data-ui-command]",(e=>{const t=o.getDataset(e.currentTarget,"uiCommand");if(!(t in this))throw new Error(`Unknown command ${t}`);if(e.preventDefault(),this._lastRange){const e=window.getSelection();e.removeAllRanges(),e.addRange(this._lastRange)}const s=o.getDataset(e.currentTarget,"uiValue");this[t](s),this._refreshToolbar()}))},f._execCommand=function(e,t){o.is(this._node,":disabled")||(this._focusEditor(),document.execCommand("styleWithCSS",!1,["backColor","fontName","fontSize","foreColor"].includes(e)),["insertOrderedList","insertUnorderedList"].includes(e)&&(this._observe(!1),document.execCommand("formatBlock",!1,"p"),this._observe()),document.execCommand(e,!1,t))},f._focusEditor=function(){if(o.isSame(this._editor,document.activeElement)||o.hasDescendent(this._editor,document.activeElement))return;const e=window.getSelection();e.anchorNode&&o.hasDescendent(this._editor,e.anchorNode)||o.focus(this._editor)},f._fontDropdown=function(e){const t=this._options.fonts.sort();for(const s of t){const t=o.create("li",{text:s,class:this.constructor.classes.dropdownItem,style:{fontFamily:s},attributes:{role:"button","aria-label":s}}),i={command:"fontName",value:s};this._buttons.push({button:t,data:i}),this._setToolbarData(t,i),o.append(e,t)}},f._fontSizeDropdown=function(e){const t=Object.values(this.constructor.fontSizes);for(const s of t){const t=o.create("li",{text:s,class:this.constructor.classes.dropdownItem,attributes:{role:"button","aria-label":s}}),i={command:"fontSize",value:s};this._buttons.push({button:t,data:i}),this._setToolbarData(t,i),o.append(e,t)}},f._getSelectionData=function(){const{anchorNode:e,anchorOffset:t,focusNode:s,focusOffset:i}=window.getSelection();return e&&s&&(o.isSame(this._editor,e)||o.hasDescendent(this._editor,e))&&(o.isSame(this._editor,s)||o.hasDescendent(this._editor,s))?{anchorPath:p(e,this._editor),anchorOffset:t,focusPath:p(s,this._editor),focusOffset:i}:null},f._highlightImage=function(e){o.hide(this._imgHighlight),o.hide(this._imgCursor);const t=o.rect(e,{offset:!0}),s=o.position(this._editor,{offset:!0}),i=o.getScrollX(this._editorScroll),r=o.getScrollY(this._editorScroll),n=Math.round(t.x),a=Math.round(t.y),l=Math.round(t.width),d=Math.round(t.height);o.setStyle(this._imgHighlight,{top:a-s.y+r-2+"px",left:n-s.x+i-2+"px",width:`${l+2}px`,height:`${d+2}px`}),o.setText(this._imgSize,`${l}x${d}`),l<100||d<50?o.hide(this._imgSize):o.show(this._imgSize),o.show(this._imgHighlight),o.show(this._imgCursor)},f._insertNode=function(e){this._focusEditor();const t=s();return t.deleteContents(),t.insertNode(e),t.collapse(!1),e},f._normalize=function(){this._observe(!1),o.normalize(this._editor);const e=function(){const e=window.getSelection();let t,s;if(e.rangeCount){t=o.createText(""),s=o.createText("");const i=e.getRangeAt(0),r=i.cloneRange(),n=i.cloneRange();r.collapse(!0),n.collapse(!1),r.insertNode(t),n.insertNode(s)}return{start:t,end:s}}();!function(e){const t=o.find("[style]",e);for(const s of t){const t=o.getStyle(s);for(const[i,r]of Object.entries(t)){if("inherit"===r){o.removeStyle(s,i);continue}const t=o.clone(s,{deep:!1});o.after(s,t),o.removeAttribute(t,"style");let n=o.css(t,i);o.detach(t),"background-color"===i&&n===m&&(n=[e,...o.parents(s,null,e)].map((e=>o.css(e,i))).filter((e=>e!==m)).pop()),o.css(s,i)===n&&o.removeStyle(s,i)}""===o.getAttribute(s,"style")&&o.removeAttribute(s,"style")}}(this._editor),function(e){const t=o.find("span",e);for(const e of t){if([...o.getProperty(e,"attributes")].length)continue;const t=o.contents(e);t.length&&(o.after(e,t),next=t[0]),o.detach(e)}}(this._editor),function(e){const t=o.find("h1, h2, h3, h4, h5, h6, p, pre",e);for(const e of t){const t=o.contents(e);if(t.length){for(const[s,i]of t.entries()){if(v(i))continue;const r=t.splice(s);o.after(e,r);break}t.length||o.detach(e)}}}(this._editor),function(e,t){const s=o.find("*",e),i=e=>t.start&&o.isSame(e,t.start)||t.end&&o.isSame(e,t.end);for(const e of s){if(i(e)||!g(e))continue;const t=[];let s=e.nextSibling;for(;s&&i(s);)t.push(s),s=s.nextSibling;s&&g(s)&&o.isEqual(e,s,{shallow:!0})&&(o.prepend(s,o.contents(e)),t.length&&o.prepend(s,t),o.detach(e))}}(this._editor,e),function({start:e,end:t}={}){if(!e&&!t)return;const s=o.createRange();e&&o.isConnected(e)&&(s.setStartAfter(e),o.detach(e)),t&&o.isConnected(t)&&(s.setEndBefore(t),o.detach(t));const i=window.getSelection();i.removeAllRanges(),i.addRange(s)}(e),o.normalize(this._editor),this._observe()},f._refreshCursor=function(){const e=window.getSelection().baseNode;if(!o.hasDescendent(this._editor,e))return void this._removePopover();const t=o.is(e,"a")?e:o.closest(e,"a",this._editor).shift();t?this._refreshPopover(t):this._removePopover()},f._refreshDisabled=function(){o.is(this._node,":disabled")?(o.addClass(this._editor,this.constructor.classes.editorDisabled),o.setStyle(this._editor,{opacity:.5}),o.removeAttribute(this._editor,"contenteditable"),o.setAttribute(this._editor,{"aria-disabled":!0}),o.setAttribute(this._source,{disabled:!0})):(o.removeClass(this._editor,this.constructor.classes.editorDisabled),o.setStyle(this._editor,{opacity:""}),o.setAttribute(this._editor,{contenteditable:!0}),o.removeAttribute(this._editor,"aria-disabled"),o.removeAttribute(this._source,"disabled"))},f._refreshLineNumbers=function(){if(!o.isVisible(this._sourceContainer))return;const e=o.contents(this._lineNumbers),t=o.getValue(this._source).split("\n"),s=o.create("div",{style:{width:o.width(this._source,{boxSize:o.CONTENT_BOX}),padding:0,border:0,font:o.css(this._source,"font"),letterSpacing:o.css(this._source,"letterSpacing"),whiteSpace:o.css(this._source,"whiteSpace"),wordBreak:o.css(this._source,"wordBreak"),wordSpacing:o.css(this._source,"wordSpacing"),wordWrap:o.css(this._source,"wordWrap")}});o.append(document.body,s);for(const[i,r]of t.entries()){let t;i<e.length?t=e[i]:(t=o.create("div",{text:i+1}),o.append(this._lineNumbers,t)),o.setText(s,r||" ");const{height:n}=o.rect(s);o.setStyle(t,{height:`${n}px`})}o.detach(s),e.length>t.length&&o.detach(e.slice(t.length))},f._refreshPopover=function(e,s){if(o.isSame(e,this._currentNode))return;if(this._removePopover(),this._currentNode=e,!this._currentNode)return;const i=o.tagName(this._currentNode);let r=this._currentNode;if(s&&"img"===i){const e=o.position(this._editor,{offset:!0}),t=o.getScrollX(this._editorScroll),i=o.getScrollY(this._editorScroll);o.setStyle(this._imgCursor,{top:`${s.pageY-e.y+i}px`,left:`${s.pageX-e.x+t}px`}),r=this._imgCursor}switch(this._popper=new t.Popper(this._popover,{reference:r,arrow:this._popoverArrow,container:this._editor,placement:"bottom",position:"left",minContact:0,noAttributes:!0}),o.show(this._popover),i){case"a":this._renderPopoverItems(this._options.popovers.link);break;case"img":this._renderPopoverItems(this._options.popovers.image),this._highlightImage(this._currentNode),o.show(this._imgHighlight);break;case"td":this._renderPopoverItems(this._options.popovers.table)}this._popper.update()},f._refreshToolbar=function(){this._focusEditor();const e=o.is(this._node,":disabled"),t=o.isVisible(this._sourceContainer);for(const{button:s,data:i,type:r}of this._buttons){if("setContent"in i){const e=i.setContent.bind(this)();o.setHTML(s,e)}let n=!1;"command"in i&&(n="value"in i?document.queryCommandValue(i.command)===i.value:document.queryCommandState(i.command)),n?(o.addClass(s,"active"),o.setAttribute(s,{"aria-pressed":!0})):(o.removeClass(s,"active"),o.removeAttribute(s,"aria-pressed")),e||t&&!["source","fullScreen"].includes(r)||"disableCheck"in i&&i.disableCheck.bind(this)()?(o.addClass(s,"disabled"),o.setAttribute(s,{"aria-disabled":!0})):(o.removeClass(s,"disabled"),o.removeAttribute(s,"aria-disabled"))}},f._removeModal=function(){this._modal&&(t.Modal.init(this._modal).dispose(),o.remove(this._modal),this._modal=null)},f._removePopover=function(){this._currentNode&&(o.hide(this._imgHighlight),o.hide(this._imgCursor),o.hide(this._popover),o.empty(this._popoverBody),this._popper.dispose(),this._popper=null,this._currentNode=null)},f._render=function(){this._container=o.create("div",{class:this.constructor.classes.container}),this._renderToolbar(),this._editorBody=o.create("div",{class:this.constructor.classes.editorBody,style:{height:this._options.height}}),o.append(this._container,this._editorBody),this._renderEditor(),this._renderSource(),this._renderPopover(),this._renderDrop(),this._options.resizable&&this._renderResize(),o.hide(this._node),o.setAttribute(this._node,{tabindex:-1}),o.insertBefore(this._container,this._node)},f._renderButton=function(e){const s=o.create("button",{class:this.constructor.classes.btn});if(e.setTitle&&(e.title=e.setTitle.bind(this)()),e.title&&(o.setAttribute(s,{title:e.title,"aria-label":e.title}),t.Tooltip.init(s,{appendTo:document.body,placement:"bottom"})),"content"in e)o.setHTML(s,e.content);else{const t=o.parseHTML(this.constructor.icons[e.icon]);o.addClass(t,this.constructor.classes.btnIcon),o.append(s,t)}return s},f._renderDrop=function(){this._dropTarget=o.create("div",{class:this.constructor.classes.dropTarget}),this._dropText=o.create("span",{text:this.constructor.lang.drop.dropHere,class:this.constructor.classes.dropText}),o.append(this._dropTarget,this._dropText),o.hide(this._dropTarget),o.append(this._container,this._dropTarget)},f._renderEditor=function(){this._editorScroll=o.create("div",{class:this.constructor.classes.editorScroll}),this._editorContainer=o.create("div",{class:this.constructor.classes.editorContainer}),this._editor=o.create("div",{class:this.constructor.classes.editor,style:{fontFamily:this._options.defaultFont},attributes:{role:"textbox","aria-multline":!0,spellcheck:!0,autocorrect:!0}}),this._imgHighlight=o.create("div",{class:this.constructor.classes.imgHighlight}),this._imgCursor=o.create("div",{class:this.constructor.classes.imgCursor}),this._imgSize=o.create("div",{class:this.constructor.classes.imgSize}),this._imgResize=o.create("div",{class:this.constructor.classes.imgResize}),o.hide(this._imgHighlight),o.append(this._imgHighlight,this._imgSize),o.append(this._imgHighlight,this._imgResize),o.append(this._editorContainer,this._imgCursor),o.append(this._editorContainer,this._imgHighlight),o.append(this._editorContainer,this._editor),o.append(this._editorScroll,this._editorContainer),o.append(this._editorBody,this._editorScroll)},f._renderPopover=function(){this._popover=o.create("div",{class:this.constructor.classes.popover,attributes:{role:"tooltip"}}),this._popoverArrow=o.create("div",{class:this.constructor.classes.popoverArrow}),this._popoverBody=o.create("div",{class:this.constructor.classes.popoverBody}),o.hide(this._popover),o.append(this._popover,this._popoverArrow),o.append(this._popover,this._popoverBody),o.append(this._container,this._popover)},f._renderPopoverItem=function(e,t){const s=this.constructor.popovers[e];let i;s.render?i=s.render.bind(this)(this._currentNode):(i=this._renderButton({icon:e,title:this.constructor.lang.popovers[e],...s}),o.setDataset(i,{uiAction:e})),o.append(t,i)},f._renderPopoverItems=function(e){for(const t of e)if(o._isString(t))this._renderPopoverItem(t,this._popoverBody);else{const e=o.create("div",{class:this.constructor.classes.btnGroup,attributes:{role:"group"}});for(const o of t)this._renderPopoverItem(o,e);o.append(this._popoverBody,e)}},f._renderResize=function(){this._resizeBar=o.create("div",{class:this.constructor.classes.resizeBar});for(let e=0;e<3;e++){const e=o.create("hr");o.append(this._resizeBar,e)}o.append(this._container,this._resizeBar)},f._renderSource=function(){this._sourceOuter=o.create("div",{class:this.constructor.classes.sourceOuter}),this._sourceContainer=o.create("div",{class:this.constructor.classes.sourceContainer}),this._lineNumbers=o.create("div",{class:this.constructor.classes.sourceLines}),this._sourceScroll=o.create("div",{class:this.constructor.classes.sourceScroll}),this._source=o.create("textarea",{class:this.constructor.classes.source}),o.hide(this._sourceOuter),o.append(this._sourceScroll,this._source),o.append(this._sourceContainer,this._lineNumbers),o.append(this._sourceContainer,this._sourceScroll),o.append(this._sourceOuter,this._sourceContainer),o.append(this._editorBody,this._sourceOuter)},f._renderToolbar=function(){const e=o.create("div",{class:this.constructor.classes.toolbar});this._toolbar=o.create("div",{class:this.constructor.classes.toolbarButtons,attributes:{role:"toolbar"}});for(const e of this._options.buttons){const t=o.create("div",{class:this.constructor.classes.btnGroup});for(const o of e)this._renderToolbarButton(o,t);o.append(this._toolbar,t)}o.append(e,this._toolbar),o.append(this._container,e)},f._renderToolbarButton=function(e,t){const s=this.constructor.plugins[e],i=this._renderButton({icon:e,title:this.constructor.lang.plugins[e],...s});this._buttons.push({button:i,data:s,type:e}),this._setToolbarData(i,s,e),"dropdown"in s?this._renderToolbarDropdown(t,i,s.dropdown):o.append(t,i)},f._renderToolbarDropdown=function(e,t,s){const i=o.create("div",{class:this.constructor.classes.dropdownGroup,attributes:{role:"group"}});o.addClass(t,this.constructor.classes.dropdownToggle),o.setDataset(t,{uiToggle:"dropdown"}),o.setAttribute(t,{"aria-has-popup":!0,"aria-expanded":!1}),o.append(i,t);const r=o.create("ul",{class:this.constructor.classes.dropdown});if(o._isArray(s)){o.addClass(r,this.constructor.classes.dropdownButtons);for(const e of s){const t=o.create("div",{class:this.constructor.classes.btnGroup,attributes:{role:"group"}});for(const o of e)this._renderToolbarButton(o,t);o.append(r,t)}}else o._isFunction(s)&&s.bind(this)(r);o.append(i,r),o.append(e,i)},f._resetDropText=function(){o.removeClass(this._dropText,this.constructor.classes.dropHover),o.setText(this._dropText,this.constructor.lang.drop.dropHere)},f._restoreHistory=function({html:e,selectionData:t=null}={}){this._observe(!1),o.setHTML(this._editor,e),o.setValue(this._node,e),o.setValue(this._source,e);const s=window.getSelection();if(t){const e=u(t.anchorPath,this._editor),o=u(t.focusPath,this._editor);s.setBaseAndExtent(e,t.anchorOffset,o,t.focusOffset)}else s.selectAllChildren(this._editor),s.collapseToEnd();this._checkEmpty(),this._observe()},f._setToolbarData=function(e,t,s){t.command?(o.setDataset(e,{uiCommand:t.command}),t.value&&o.setDataset(e,{uiValue:t.value})):t.action&&s&&o.setDataset(e,{uiAction:s})},f._showDropTarget=function(){o.is(this._node,":disabled")||o.isVisible(this._sourceContainer)||o.show(this._dropTarget)},f._showEditor=function(){o.show(this._editorScroll),o.hide(this._sourceOuter)},f._showImageModal=function(){const e=o.create("div"),{group:i,input:n}=this.constructor._createFileInput({id:t.generateId("editor-image-file"),label:this.constructor.lang.modals.imageFile,attributes:{accept:"image/*",multiple:!0}}),{group:a,input:l}=this.constructor._createInput({id:t.generateId("editor-image-url"),label:this.constructor.lang.modals.imageUrl});o.append(e,i),o.append(e,a);const d=s();this._focusEditor();const c=s();c.collapse(),this._modal=this.constructor._createModal({title:this.constructor.lang.modals.insertImage,content:e,cancelText:this.constructor.lang.modals.cancel,submitText:this.constructor.lang.modals.insertImage,onSubmit:e=>{r(c);const t=o.getProperty(n,"files"),s=o.getValue(l);t.length?this._options.imageUpload.bind(this)(t):s&&this.insertImage(s)},onShown:e=>{o.focus(n)},onHidden:e=>{this._removeModal(),r(d)}})},f._showLinkModal=function(e){const n=o.create("div"),{group:a,input:l}=this.constructor._createInput({id:t.generateId("editor-link-text"),label:this.constructor.lang.modals.linkText}),{group:d,input:c}=this.constructor._createInput({id:t.generateId("editor-link-url"),label:this.constructor.lang.modals.linkUrl}),{group:h,input:u}=this.constructor._createCheckbox({id:t.generateId("editor-link-new-window"),label:this.constructor.lang.modals.linkNewWindow});if(e){const t=o.getText(e),s=o.getAttribute(e,"href"),i=o.getAttribute(e,"target");o.setValue(l,t),o.setValue(c,s),"_blank"===i&&o.setProperty(u,{checked:!0})}let p=!1;o.addEvent(l,"input.ui.editor",(e=>{p=!!o.getValue(l)})),o.addEvent(c,"input.ui.editor",(e=>{if(p)return;const t=o.getValue(c);o.setValue(l,t)})),o.append(n,a),o.append(n,d),o.append(n,h);const m=s();let v;e?v=i(e):(this._focusEditor(),v=s()),this._modal=this.constructor._createModal({title:this.constructor.lang.modals.insertLink,content:n,cancelText:this.constructor.lang.modals.cancel,submitText:this.constructor.lang.modals.insertLink,onSubmit:e=>{r(v);const t=o.getValue(l),s=o.getValue(c),i=o.is(u,":checked");this.insertLink(s,t,i)},onShown:e=>{o.focus(c)},onHidden:e=>{this._removeModal(),r(m)}})},f._showSource=function(){o.show(this._sourceOuter),o.setStyle(this._editorScroll,{display:"none"},null,{important:!0}),o.hide(this._imgHighlight),this._refreshLineNumbers()},f._showVideoModal=function(){const e=o.create("div"),{group:i,input:n,invalidFeedback:a}=this.constructor._createInput({id:t.generateId("editor-video-url"),label:this.constructor.lang.modals.videoUrl});o.append(e,i);const l=s();this._focusEditor();const d=s();this._modal=this.constructor._createModal({title:this.constructor.lang.modals.insertVideo,content:e,cancelText:this.constructor.lang.modals.cancel,submitText:this.constructor.lang.modals.insertVideo,onSubmit:e=>{r(d);const t=o.getValue(n).match(/youtube\.com\/watch\?v=([\w]+)/i);if(!t)return o.addClass(i,this.constructor.classes.formError),o.setText(a,this.constructor.lang.modals.videoUrlInvalid),!1;o.removeClass(i,this.constructor.classes.formError);const s=t[1],l=o.create("iframe",{attributes:{width:560,height:315,src:`https://www.youtube.com/embed/${s}`,frameborder:0,allowfullscreen:!0}}),c=o.getProperty(l,"outerHTML");this.insertHTML(c)},onShown:e=>{o.focus(n)},onHidden:e=>{this._removeModal(),r(l)}})},f._styleDropdown=function(e){for(const t of this.constructor.styles){const s=o.create("li",{class:this.constructor.classes.dropdownItem,attributes:{role:"button","aria-label":this.constructor.lang.styles[t]}}),i=o.create(t,{text:this.constructor.lang.styles[t],class:this.constructor.classes.styleContent});o.append(s,i);const r={command:"formatBlock",value:t.toUpperCase()};this._buttons.push({button:s,data:r}),this._setToolbarData(s,r),o.append(e,s)}},f._tableDropdown=function(e){const t=o.create("li");for(let e=0;e<10;e++){const s=o.create("div",{class:this.constructor.classes.tableRow});o.append(t,s);for(let t=0;t<10;t++){const i=o.create("div",{class:this.constructor.classes.tableCell});o.append(s,i),(e>4||t>4)&&o.hide(i);const r=o.create("a",{class:this.constructor.classes.tableLink,attributes:{href:"#"},dataset:{uiColumn:t,uiRow:e}});o.append(i,r)}}const s=o.create("span",{class:this.constructor.classes.tableInfo});o.addClass(e,this.constructor.classes.tableDropdown),o.append(e,t),o.append(e,s),o.addEventDelegate(t,"click.ui.editor","a",(e=>{const t=o.getDataset(e.currentTarget,"uiColumn"),s=o.getDataset(e.currentTarget,"uiRow"),i=o.create("div"),r=o.create("table",{class:this.constructor.classes.table}),n=o.create("tbody");for(let e=0;e<=s;e++){const e=o.create("tr");for(let s=0;s<=t;s++){const t=o.create("td",{html:"<br>"});o.append(e,t)}o.append(n,e)}o.append(r,n),o.append(i,r);const a=o.create("br");o.append(i,a);const l=o.getHTML(i);this.insertHTML(l)})),o.addEventDelegate(t,"mouseover.ui.editor","a",(e=>{const i=o.getDataset(e.currentTarget,"uiColumn"),r=o.getDataset(e.currentTarget,"uiRow"),n=Math.max(i+1,4),a=Math.max(r+1,4),l=o.find("a",t);for(const e of l){const t=o.getDataset(e,"uiColumn"),s=o.getDataset(e,"uiRow");t<=i&&s<=r?o.addClass(e,this.constructor.classes.tableHover):o.removeClass(e,this.constructor.classes.tableHover);const l=o.parent(e);t<=n&&s<=a?o.show(l):o.hide(l)}o.setText(s,`${i+1} x ${r+1}`)}))},f._updateTable=function(e,t){const s=o.closest(e,"table",this._editor).shift();s&&(t(e,o.closest(e,"tr",this._editor).shift(),s),i(e).collapse(!0))},f._updateValue=function(){const e=o.getHTML(this._editor);if(e===o.getValue(this._node))return;this._redoHistory=[];const t=this._getSelectionData();this._addHistory({html:e,selectionData:t}),o.setValue(this._node,e),o.setValue(this._source,e),o.triggerEvent(this._node,"change.ui.editor")},t.initComponent("editor",d),e.Editor=d}));